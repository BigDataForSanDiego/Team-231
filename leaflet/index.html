<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Test</title>

    <!-- leaflet css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <style>

        body {
            margin: 0;
            padding: 0;
        }
        #map { 
            width:100%;
            height:100vh;
        }
    </style>
</head>


<body>
    <div id="map"></div>
</body>


 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>

<script>
    

    const obj = JSON.parse("[{\"Site Name\":\"10Th Ave Marine Term\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.7954300169},{\"Site Name\":\"Alpine\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0419602804},{\"Site Name\":\"Alpine\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0046211268},{\"Site Name\":\"Alpine\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":3.3907865014},{\"Site Name\":\"Alpine\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0040662021},{\"Site Name\":\"Alpine\",\"Parameter\":\"04 NO PPB\",\"Avg\":0.3385619835},{\"Site Name\":\"Alpine\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0004356298},{\"Site Name\":\"Alpine\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":25.1745886654},{\"Site Name\":\"Alpine\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":6.2669902913},{\"Site Name\":\"Alpine\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":64.0757644911},{\"Site Name\":\"Alpine\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":31.7623400366},{\"Site Name\":\"Alpine\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":0.8221816522},{\"Site Name\":\"Alpine\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":3.102285192},{\"Site Name\":\"Alpine\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.7005034325},{\"Site Name\":\"Alpine\",\"Parameter\":\"17 RELHUM %\",\"Avg\":54.3864578535},{\"Site Name\":\"Alpine\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.2859389313},{\"Site Name\":\"Alpine\",\"Parameter\":\"PM10 STD\",\"Avg\":17.1},{\"Site Name\":\"Boston Ave\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.8015689981},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0230935754},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":14.4282369146},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0141997236},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0089322626},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"06 CO PPM\",\"Avg\":0.5147555962},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":25.3531292828},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":8.2224137931},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.2802192782},{\"Site Name\":\"Carmel Mt Rch\",\"Parameter\":\"PM10 STD\",\"Avg\":19.9224137931},{\"Site Name\":\"Chicano Park\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.7352586938},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0282517483},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0103421788},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":8.695735901},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0083609959},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0020327983},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":24.8991328161},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":10.8132183908},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":62.762209037},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":26.2980374258},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":1.104564126},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":3.8545454545},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.2600638978},{\"Site Name\":\"Chula Vista\",\"Parameter\":\"PM10 STD\",\"Avg\":25.0143678161},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":null},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":null},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":null},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":null},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":null},{\"Site Name\":\"Del_Mar\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"02 NOX PPM\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"04 NO PPM\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"06 CO PPM\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":null},{\"Site Name\":\"Downtown\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":null},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0130898618},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":10.0970151307},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0101430206},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0029746544},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":24.746875},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":10.0182569975},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":12.4390243902},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":27.1664580726},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":0.2082551595},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":4.1023153942},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.515625},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"BCarbon ng\\/m3\",\"Avg\":872.9866666667},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.8873787772},{\"Site Name\":\"Downtown Ses\",\"Parameter\":\"PM10 STD\",\"Avg\":22.6627946128},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0303240093},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0115033501},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":7.5323782669},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0081982167},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0031792295},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":25.7001369238},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":10.3721658986},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":64.4984025559},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":33.3710634414},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":0.9028753994},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":3.2852578731},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":64.0522136011},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"17 RELHUM %\",\"Avg\":65.1319032405},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"18 PRES mmHg\",\"Avg\":748.6271080575},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"19 SOLAR W\\/M2\",\"Avg\":221.4103685197},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"20 UVRAD W\\/M2\",\"Avg\":10.865064695},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"25 NOY\",\"Avg\":10.9801715375},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"26 NOY-NO\",\"Avg\":8.6486594663},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"27 NO Trace\",\"Avg\":2.3227128335},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"28 SO2 Tr PPB\",\"Avg\":0.0386150907},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"29 CO Tr PPB\",\"Avg\":305.8270680147},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"PM10 STD\",\"Avg\":21.4903353057},{\"Site Name\":\"El Cajon Les\",\"Parameter\":\"RAINFALL\",\"Avg\":0.0006245803},{\"Site Name\":\"Escondido\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"02 NOX PPM\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"04 NO PPM\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"06 CO PPM\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":36.8547619048},{\"Site Name\":\"Escondido\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":0.0},{\"Site Name\":\"Escondido\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":0.0},{\"Site Name\":\"Escondido\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":null},{\"Site Name\":\"Escondido\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":null},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0313186047},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0086267313},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":7.143741403},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0074783802},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"04 NO PPB\",\"Avg\":null},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0011634349},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":24.9198083067},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":8.917816092},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":64.0754458162},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":19.3760839799},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":1.4992684042},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":5.2112076853},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.5919671383},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"17 RELHUM %\",\"Avg\":70.1757188498},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"18 PRES mmHg\",\"Avg\":748.8238247376},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"19 SOLAR W\\/M2\",\"Avg\":227.334094021},{\"Site Name\":\"Kearny Mesa\",\"Parameter\":\"PM10 STD\",\"Avg\":22.266091954},{\"Site Name\":\"Oceanview Blvd\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.6878348778},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0326255814},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0096359833},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":7.6549723757},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0074177654},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"04 NO PPB\",\"Avg\":2.6132791667},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0022047189},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":25.5503202196},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":12.9051329911},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":67.5353719763},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":23.1628545288},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":1.4919671383},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":5.0242451967},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.3703568161},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":0.4895454545},{\"Site Name\":\"Otay Mesa Dvn\",\"Parameter\":\"PM10 STD\",\"Avg\":48.7017578125},{\"Site Name\":\"Pendleton\",\"Parameter\":\"01 OZONE PPM\",\"Avg\":0.0315905707},{\"Site Name\":\"Pendleton\",\"Parameter\":\"02 NOX PPM\",\"Avg\":0.0067945007},{\"Site Name\":\"Pendleton\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":5.1445517241},{\"Site Name\":\"Pendleton\",\"Parameter\":\"03 NO2 PPM\",\"Avg\":0.0054931997},{\"Site Name\":\"Pendleton\",\"Parameter\":\"04 NO PPB\",\"Avg\":0.9915770925},{\"Site Name\":\"Pendleton\",\"Parameter\":\"04 NO PPM\",\"Avg\":0.0013309507},{\"Site Name\":\"Pendleton\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":24.824742268},{\"Site Name\":\"Pendleton\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":8.9321714555},{\"Site Name\":\"Pendleton\",\"Parameter\":\"12 VWDR \\u00b0\",\"Avg\":53.3257855823},{\"Site Name\":\"Pendleton\",\"Parameter\":\"13 SIGTHETA \\u00b0\",\"Avg\":17.695631752},{\"Site Name\":\"Pendleton\",\"Parameter\":\"14 VWSP MPH\",\"Avg\":1.3859981516},{\"Site Name\":\"Pendleton\",\"Parameter\":\"15 SWSP MPH\",\"Avg\":4.9157350869},{\"Site Name\":\"Pendleton\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":62.3883786317},{\"Site Name\":\"Pendleton\",\"Parameter\":\"PM10 STD\",\"Avg\":21.6838114754},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"03 NO2 PPB\",\"Avg\":18.3544444444},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"06 CO PPM\",\"Avg\":0.6828571429},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"07 H2S PPB\",\"Avg\":1.8857142857},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"10 INTMP \\u00b0C\",\"Avg\":22.9456521739},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"11 PM2.5 \\u00b5g\\/M3\",\"Avg\":16.7586956522},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"16 AMBTEMP \\u00b0F\",\"Avg\":63.1494505495},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"BCarbon ug\\/m3\",\"Avg\":1.2146921421},{\"Site Name\":\"San Ysidro\",\"Parameter\":\"PM10 STD\",\"Avg\":44.8586956522}]");

    

    // Returns json data array
    // function dataGetter() {
    //     fetch('everything.json')
    //     .then(response => response.json()) // Automatically parses JSON response
    //     .then(data => {
    //         const dataArray = JSON.parse(data);
    //         console.log(dataArray[0])
    //         return dataArray;
    //     })
    //     .catch(error => {
    //         console.error('Error loading the JSON file:', error);
    //     });
    // }

    // async function dataGetter() {
    //     try {
    //         const response = await fetch('everything.json');
    //         const data = await response.json();
    //         const dataArray = JSON.parse(data);
    //         console.log('Data:', dataArray[0]); // Accessing data correctly
    //         return dataArray;
    //     } catch (error) {
    //         console.error('Error loading the JSON file:', error);
    //     }
    // }

    // async function main() {
    //     const dataArray = await dataGetter();
    //     console.log(dataArray); // Should be 'object' when the promise resolves
    // }

    // main()

    console.log(obj[0]["Site Name"]);

    
    
    // Initialize the map
    var map = L.map('map').setView([32.7157, -117.1611], 10);

    // proj4.defs("EPSG:2230", "+proj=utm +zone=11 +datum=NAD83 +units=m +no_defs");

    // const map = L.map('map', {
    //     crs: L.Proj.CRS('EPSG:2230') // Correct way to initialize with Proj4Leaflet
    // }).setView([37.7749, -122.4194], 10); // Set initial view (latitude, longitude)


    // Initialize layers
    var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }
    )

    googleStreets = L.tileLayer('http://{s}.google.com/vt?lyrs=m&x={x}&y={y}&z={z}',{
        maxZoom: 19,
        subdomains:['mt0','mt1','mt2','mt3']
        }
    );

    googleStreets.addTo(map);

    var baseMaps = {
        "default": osm,
        "google maps": googleStreets
    }

    // Layer control
    L.control.layers(baseMaps).addTo(map);

    // Highlight Cities
    proj4.defs("EPSG:2230", "+proj=lcc +lat_1=33.88333333333333 +lat_2=32.78333333333333 +lat_0=32.16666666666666 +lon_0=-116.25 +x_0=2000000 +y_0=500000 +ellps=GRS80 +datum=NAD83 +units=us-ft +no_defs");

    /**
     * 
     * CHULA VISTA
     * 
     **/
    async function loadGeoJSON_ChulaVista() {
        try {
            const response = await fetch('data/Chula_Vista.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Transform the coordinates
            // const transformedGeoJSON = {
            //     ...data,
            //     features: data.features.map(feature => ({
            //         ...feature,
            //         geometry: {
            //             ...feature.geometry,
            //             coordinates: transformCoordinates(feature.geometry.coordinates, feature.geometry.type)
            //         }
            //     }))
            // };

            // console.log('Transformed GeoJSON:', transformedGeoJSON);

            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'blue',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Chula Vista</strong><br>${JSON.stringify(feature.properties, null, 2)}`;
                    layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }



    function transformCoordinates(coords, type) {
        if (type === 'Point') {
            return proj4('EPSG:2230', 'EPSG:4326', coords);
        } else if (type === 'LineString' || type === 'MultiPoint') {
            return coords.map(coord => proj4('EPSG:2230', 'EPSG:4326', coord));
        } else if (type === 'Polygon' || type === 'MultiLineString') {
            return coords.map(ring => ring.map(coord => proj4('EPSG:2230', 'EPSG:4326', coord)));
        } else if (type === 'MultiPolygon') {
            return coords.map(polygon => polygon.map(ring => ring.map(coord => proj4('EPSG:2230', 'EPSG:4326', coord))));
        }
        return coords;
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_ChulaVista();














    /**
     * 
     * DEL MAR
     * 
     **/
     async function loadGeoJSON_DelMar() {
        try {
            const response = await fetch('data/Del_Mar.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'red',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_DelMar();






    /**
     * 
     * ALPINE
     * 
     **/
     async function loadGeoJSON_Alpine() {
        try {
            const response = await fetch('data/Alpine.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'green',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_Alpine();



    
    







    /**
     * 
     * EL CAJON
     * 
     **/
     async function loadGeoJSON_ElCajon() {
        try {
            const response = await fetch('data/El_Cajon.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'green',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_ElCajon();
















    /**
     * 
     * Escondido
     * 
     **/
     async function loadGeoJSON_Escondido() {
        try {
            const response = await fetch('data/Escondido.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'green',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_Escondido();
    




























    /**
     * 
     * KEARNY MESA
     * 
     **/
     async function loadGeoJSON_KearnyMesa() {
        try {
            const response = await fetch('data/Kearny_Mesa.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'green',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_KearnyMesa();














    /**
     * 
     * DOWNTOWNSD
     * 
     **/
     async function loadGeoJSON_DTSD() {
        try {
            const response = await fetch('data/DTSD.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'black',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_DTSD();






    /**
     * 
     * OTAY MESA
     * 
     **/
     async function loadGeoJSON_OtayMesa() {
        try {
            const response = await fetch('data/otay_mesa.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'red',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_OtayMesa();






    
    /**
     * 
     * SAN YSIDRO
     * 
     **/
     async function loadGeoJSON_SanYsidro() {
        try {
            const response = await fetch('data/San_Ysidro.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'red',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_SanYsidro();















    /**
     * 
     * Pendleton
     * 
     **/
     async function loadGeoJSON_Pendleton() {
        try {
            const response = await fetch('data/Pendleton.geojson');
            const data = await response.json();
            console.log('Original GeoJSON:', data);


            // Add the GeoJSON layer to the map with click event
            L.geoJSON(data, {
                style: {
                    color: 'red',
                    fillColor: '#00f',
                    fillOpacity: 0.3
                },
                onEachFeature: function (feature, layer) {
                    // This function is called for each feature in the GeoJSON
                    layer.on('click', function (e) {
                        // Display the properties of the clicked feature
                        const properties = feature.properties || {};
                        const popupContent = `<strong>Feature Properties:</strong><br>${JSON.stringify(properties, null, 2)}`;
                        layer.bindPopup(popupContent).openPopup();
                    });
                }
            }).addTo(map);
            
        } catch (error) {
            console.error('Error loading or transforming GeoJSON:', error);
        }
    }

    // Call the function to load (and mayhaps transform) the GeoJSON
    loadGeoJSON_Pendleton();





    


    // Create a popup when left clicking
    var popup = L.popup();
    function onMapClick(e) {
        keys = e.latlng // this is a dictionary

        // // General boundaries for Chula Vista
        // if ((keys.lat < 32.6590 && keys.lat > 32.5922) && (keys.lng > -117.1273 && keys.lng < -116.9350)) {
        //     popup
        //     .setLatLng(e.latlng)
        //     .setContent("You are in Chula Vista")
        //     .openOn(map);
        // }

        // Default popup message
        // else {
            popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
        // }
        
    }   

    // Call onMapClick when clicking
    map.on('click', onMapClick);

    fetch('http://localhost:8080/city_outputs/Alpine.json')
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        console.log(data);
    })
    .catch(error => {
        console.error('Error reading the JSON file:', error);
    });





</script>